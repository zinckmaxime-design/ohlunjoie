<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ohlun'Joie V3.0</title>
  <meta name="description" content="Gestion √©v√©nements association Ohlun'Joie">
  <link rel="stylesheet" href="style-v3-final.css">
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <span id="app-logo" aria-hidden="true">üìÖ</span>
      <h1>Ohlun'Joie</h1>
    </div>
    <nav class="main-nav">
      <button id="themeToggle" class="icon-btn" aria-label="Basculer le th√®me">üåô</button>
      <button id="menuToggle" class="icon-btn" aria-label="Menu">‚ò∞</button>
    </nav>
  </header>

  <main class="app-main">
    <!-- SECTION PUBLIQUE -->
    <section id="publicSection" class="section">
      <header class="section-header">
        <h2>√âv√©nements</h2>
        <p id="introText" class="intro"></p>
        <div class="view-switch">
          <button data-view="timeline" class="view-btn active">Timeline</button>
          <button data-view="list" class="view-btn">Liste</button>
          <button data-view="cards" class="view-btn">Cartes</button>
        </div>
        <div id="nextEventCountdown" class="countdown" aria-live="polite"></div>
      </header>
      <div id="eventsContainer" class="events-grid"></div>

      <!-- Formulaire inscription -->
      <section id="inscriptionSection" class="card">
        <h3>Inscription</h3>
        <form id="inscriptionForm" novalidate>
          <div class="grid">
            <label>Pr√©nom*<input type="text" name="prenom" required></label>
            <label>Nom*<input type="text" name="nom" required></label>
            <label>Email*<input type="email" name="email" required></label>
            <label>T√©l√©phone*<input type="tel" name="telephone" required></label>
          </div>
          <label>Commentaire<textarea name="commentaire" rows="3"></textarea></label>
          <fieldset>
            <legend>Participations (min 1)</legend>
            <label><input type="checkbox" name="preparation_salle"> Pr√©paration salle</label>
            <label><input type="checkbox" name="partie_evenement"> Partie soir√©e</label>
            <label><input type="checkbox" name="evenement_entier"> Soir√©e enti√®re</label>
          </fieldset>
          <label>√âv√©nement<select name="event_id" id="inscriptionEventSelect" required></select></label>
          <p class="rgpd">Vos donn√©es sont utilis√©es uniquement pour la gestion des inscriptions et ne seront jamais transmises √† des tiers.</p>
          <button type="submit" class="primary">S'inscrire</button>
        </form>
      </section>
    </section>

    <!-- SECTION ADMIN -->
    <section id="adminSection" class="section">
      <header class="section-header">
        <h2>Administration</h2>
        <div class="admin-auth">
          <input type="email" id="adminEmail" placeholder="Email admin">
          <input type="password" id="adminPassword" placeholder="Mot de passe">
          <button id="adminLoginBtn" class="primary">Connexion</button>
          <span id="adminUserInfo"></span>
        </div>
        <div class="admin-tabs">
          <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
          <button class="tab-btn" data-tab="events">√âv√©nements</button>
          <button class="tab-btn" data-tab="stats">Statistiques</button>
          <button class="tab-btn" data-tab="volunteers">B√©n√©voles</button>
          <button class="tab-btn" data-tab="admins">Gestion Admins</button>
          <button class="tab-btn" data-tab="config">Configuration</button>
          <button class="tab-btn" data-tab="logs">Logs</button>
        </div>
      </header>

      <!-- TAB DASHBOARD -->
      <div id="tab-dashboard" class="tab-panel active">
        <div class="kpi-grid">
          <div class="kpi"><div class="kpi-title">Total Inscrits</div><div id="kpiTotalInscrits" class="kpi-value">0</div></div>
          <div class="kpi"><div class="kpi-title">√âv√©nements Actifs</div><div id="kpiEventsActifs" class="kpi-value">0</div></div>
          <div class="kpi"><div class="kpi-title">Emails Uniques</div><div id="kpiEmailsUniques" class="kpi-value">0</div></div>
          <div class="kpi"><div class="kpi-title">Taux Moyen</div><div id="kpiTauxMoyen" class="kpi-value">0%</div></div>
        </div>
      </div>

      <!-- TAB √âV√âNEMENTS -->
      <div id="tab-events" class="tab-panel">
        <div class="toolbar">
          <div class="filters">
            <button class="filter-btn active" data-filter="actifs">üü¢ Actifs</button>
            <button class="filter-btn" data-filter="masques">üü† Masqu√©s</button>
            <button class="filter-btn" data-filter="archives">‚ö´ Archiv√©s</button>
            <button class="filter-btn" data-filter="tous">üìã Tous</button>
          </div>
          <button id="openCreateEvent" class="primary">Cr√©er un √©v√©nement</button>
        </div>
        <div id="adminEventsCards" class="cards-grid"></div>
      </div>

      <!-- TAB STATISTIQUES -->
      <div id="tab-stats" class="tab-panel">
        <div class="kpi-grid">
          <div class="kpi"><div class="kpi-title">Vues de pages</div><div id="kpiPageViews" class="kpi-value">0</div></div>
          <div class="kpi"><div class="kpi-title">Clics √©v√©nements</div><div id="kpiEventClicks" class="kpi-value">0</div></div>
        </div>
        <div class="exports">
          <button id="exportEmails" class="secondary">Exporter emails (TXT)</button>
          <button id="exportStatsCsv" class="secondary">Exporter stats (CSV)</button>
        </div>
        <div id="statsTableWrap" class="table-wrap">
          <table id="statsTable">
            <thead><tr><th>√âv√©nement</th><th>Vues</th><th>Clics</th><th>Inscrits</th><th>Places</th><th>Taux</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- TAB B√âN√âVOLES -->
      <div id="tab-volunteers" class="tab-panel">
        <div class="toolbar">
          <input type="search" id="searchVolunteer" placeholder="Rechercher nom/pr√©nom/email">
          <button id="exportVolunteersCsv" class="secondary">Exporter b√©n√©voles (CSV)</button>
        </div>
        <div id="volunteersList" class="list"></div>
      </div>

      <!-- TAB GESTION ADMINS -->
      <div id="tab-admins" class="tab-panel">
        <div class="toolbar">
          <button id="openCreateAdmin" class="primary">Ajouter un admin</button>
        </div>
        <div class="table-wrap">
          <table id="adminsTable">
            <thead><tr><th>Email</th><th>Nom</th><th>Voir √©v.</th><th>√âditer √©v.</th><th>Stats</th><th>Logs</th><th>B√©n√©v.</th><th>G√©rer admins</th><th>Config</th><th>Actions</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- TAB CONFIGURATION -->
      <div id="tab-config" class="tab-panel">
        <form id="configForm" class="card" novalidate>
          <label>Logo (Base64, max 2MB)<input type="file" id="logoInput" accept="image/*"></label>
          <div class="preview" id="logoPreview"></div>
          <div class="actions">
            <button type="button" id="saveLogo" class="secondary">Uploader logo</button>
            <button type="button" id="deleteLogo" class="danger">Supprimer logo</button>
          </div>
          <label>Texte d'introduction<textarea id="introTextInput" rows="4"></textarea></label>
          <label>Types d'√©v√©nements (JSON array)<textarea id="eventTypesInput" rows="3"></textarea></label>
          <button type="button" id="saveConfig" class="primary">Enregistrer</button>
        </form>
      </div>

      <!-- TAB LOGS -->
      <div id="tab-logs" class="tab-panel">
        <div id="logsList" class="list"></div>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <a href="https://www.linkedin.com/in/zinck-maxime-88302b207" target="_blank" rel="noopener">D√©velopp√© avec ‚ù§Ô∏è par Zinck Maxime ‚Äî LinkedIn</a>
  </footer>

  <!-- MODALES -->
  <dialog id="eventModal" class="modal">
    <form id="eventForm" method="dialog">
      <h3 id="eventModalTitle">Cr√©er/Modifier √©v√©nement</h3>
      <div class="grid">
        <label>Titre*<input name="titre" required></label>
        <label>Type*<select name="type" id="eventTypeSelect" required></select></label>
        <label>Date*<input type="date" name="date" required></label>
        <label>Heure*<input type="time" name="heure" required></label>
        <label>Lieu*<input name="lieu" required></label>
        <label>Places max*<input type="number" name="max_participants" min="1" required></label>
        <label>Emoji<input name="image" placeholder="üòä"></label>
      </div>
      <label>Description*<textarea name="description" rows="4" required></textarea></label>
      <menu>
        <button value="cancel">Annuler</button>
        <button value="submit" class="primary">Enregistrer</button>
      </menu>
    </form>
  </dialog>

  <dialog id="confirmModal" class="modal">
    <div>
      <p id="confirmMessage">Confirmer l'action ?</p>
      <menu>
        <button id="confirmCancel">Annuler</button>
        <button id="confirmOk" class="danger">Confirmer</button>
      </menu>
    </div>
  </dialog>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <div id="spinner" class="spinner" aria-hidden="true"></div>

  <!-- SUPABASE CDN V2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- APP SCRIPT -->
  <script src="app-v3-final.js"></script>
</body>
</html>
