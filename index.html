<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ohlun'Joie V3.0 - Gestion Événements Associatifs</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  
  <!-- PUBLIC VIEW -->
  <div id="public-view">
    
    <!-- HEADER -->
    <header class="header">
      <div class="container">
        <div class="header-content">
          <div class="logo-section">
            <img id="app-logo" src="" alt="Logo" class="logo-img" style="display:none;">
            <h1 class="app-title">Ohlun'Joie V3.0</h1>
          </div>
          <div class="header-actions">
            <button id="theme-toggle" class="btn-icon" aria-label="Changer de thème">
              <span class="icon-sun">☀️</span>
              <span class="icon-moon">🌙</span>
            </button>
            <button id="admin-login-btn" class="btn btn-primary">Administration</button>
          </div>
        </div>
      </div>
    </header>

    <!-- INTRO SECTION -->
    <section class="intro-section">
      <div class="container">
        <p id="intro-text" class="intro-text">Bienvenue sur la plateforme événementielle Ohlun'Joie ! Participez, organisez, partagez.</p>
      </div>
    </section>

    <!-- COUNTDOWN -->
    <section class="countdown-section">
      <div class="container">
        <div class="countdown-card">
          <p class="countdown-label">Prochain événement dans</p>
          <p id="countdown-display" class="countdown-value">Chargement...</p>
        </div>
      </div>
    </section>

    <!-- VIEW SWITCHER -->
    <section class="view-switcher-section">
      <div class="container">
        <div class="view-switcher">
          <button class="view-btn active" data-view="timeline">📅 Timeline</button>
          <button class="view-btn" data-view="list">📋 Liste</button>
          <button class="view-btn" data-view="cards">🃏 Cartes</button>
        </div>
      </div>
    </section>

    <!-- EVENTS DISPLAY -->
    <section class="events-section">
      <div class="container">
        <div id="events-container" class="events-timeline"></div>
        <div id="events-loading" class="loading-spinner">Chargement des événements...</div>
        <div id="events-empty" class="empty-state" style="display:none;">
          <p>Aucun événement disponible pour le moment</p>
        </div>
      </div>
    </section>

    <!-- RGPD NOTICE -->
    <section class="rgpd-section">
      <div class="container">
        <div class="rgpd-notice">
          <p><strong>Protection des données :</strong> Vos informations personnelles sont collectées uniquement pour la gestion des inscriptions et ne seront jamais partagées avec des tiers. Conformément au RGPD, vous disposez d'un droit d'accès, de modification et de suppression de vos données.</p>
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="footer">
      <div class="container">
        <p>&copy; 2025 Ohlun'Joie - Tous droits réservés</p>
      </div>
    </footer>

  </div>

  <!-- ADMIN VIEW -->
  <div id="admin-view" style="display:none;">
    
    <!-- ADMIN HEADER -->
    <header class="admin-header">
      <div class="container">
        <div class="admin-header-content">
          <h1 class="admin-title">📊 Administration Ohlun'Joie</h1>
          <div class="admin-header-actions">
            <span id="admin-user-display" class="admin-user-name"></span>
            <button id="theme-toggle-admin" class="btn-icon" aria-label="Changer de thème">
              <span class="icon-sun">☀️</span>
              <span class="icon-moon">🌙</span>
            </button>
            <button id="admin-logout-btn" class="btn btn-secondary">Déconnexion</button>
          </div>
        </div>
      </div>
    </header>

    <!-- ADMIN TABS -->
    <nav class="admin-tabs">
      <div class="container">
        <div class="tabs-wrapper">
          <button class="tab-btn active" data-tab="dashboard">📊 Dashboard</button>
          <button class="tab-btn" data-tab="events">🎉 Événements</button>
          <button class="tab-btn" data-tab="stats">📈 Statistiques</button>
          <button class="tab-btn" data-tab="volunteers">👥 Bénévoles</button>
          <button class="tab-btn" data-tab="admins">🔐 Admins</button>
          <button class="tab-btn" data-tab="config">⚙️ Configuration</button>
          <button class="tab-btn" data-tab="logs">📜 Logs</button>
        </div>
      </div>
    </nav>

    <!-- ADMIN CONTENT -->
    <div class="admin-content">
      <div class="container">
        
        <!-- DASHBOARD TAB -->
        <div id="tab-dashboard" class="tab-content active">
          <h2 class="section-title">Tableau de bord</h2>
          <div class="kpi-grid">
            <div class="kpi-card">
              <div class="kpi-icon">👤</div>
              <div class="kpi-info">
                <p class="kpi-label">Total Inscrits</p>
                <p id="kpi-inscrits" class="kpi-value">0</p>
              </div>
            </div>
            <div class="kpi-card">
              <div class="kpi-icon">🎉</div>
              <div class="kpi-info">
                <p class="kpi-label">Événements Actifs</p>
                <p id="kpi-events-actifs" class="kpi-value">0</p>
              </div>
            </div>
            <div class="kpi-card">
              <div class="kpi-icon">📧</div>
              <div class="kpi-info">
                <p class="kpi-label">Emails Uniques</p>
                <p id="kpi-emails-uniques" class="kpi-value">0</p>
              </div>
            </div>
            <div class="kpi-card">
              <div class="kpi-icon">📊</div>
              <div class="kpi-info">
                <p class="kpi-label">Taux Moyen</p>
                <p id="kpi-taux-moyen" class="kpi-value">0%</p>
              </div>
            </div>
          </div>
        </div>

        <!-- EVENTS TAB -->
        <div id="tab-events" class="tab-content">
          <div class="section-header">
            <h2 class="section-title">Gestion des événements</h2>
            <button id="btn-add-event" class="btn btn-primary">➕ Créer un événement</button>
          </div>
          
          <div class="filters-bar">
            <button class="filter-btn active" data-filter="actifs">🟢 Actifs</button>
            <button class="filter-btn" data-filter="masques">🟠 Masqués</button>
            <button class="filter-btn" data-filter="archives">⚫ Archivés</button>
            <button class="filter-btn" data-filter="tous">🔵 Tous</button>
          </div>

          <div id="admin-events-container" class="admin-events-grid"></div>
        </div>

        <!-- STATS TAB -->
        <div id="tab-stats" class="tab-content">
          <div class="section-header">
            <h2 class="section-title">Statistiques détaillées</h2>
            <div class="stats-actions">
              <button id="btn-export-emails" class="btn btn-secondary">📧 Export Emails (TXT)</button>
              <button id="btn-export-stats-csv" class="btn btn-secondary">📊 Export Stats CSV</button>
            </div>
          </div>

          <div class="kpi-row">
            <div class="kpi-card-small">
              <p class="kpi-label">Vues Pages</p>
              <p id="stats-page-views" class="kpi-value">0</p>
            </div>
            <div class="kpi-card-small">
              <p class="kpi-label">Clics Événements</p>
              <p id="stats-event-clicks" class="kpi-value">0</p>
            </div>
          </div>

          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Titre</th>
                  <th>Vues</th>
                  <th>Clics</th>
                  <th>Inscrits</th>
                  <th>Places</th>
                  <th>Taux %</th>
                </tr>
              </thead>
              <tbody id="stats-table-body">
                <tr>
                  <td colspan="6" class="table-empty">Aucune donnée disponible</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- VOLUNTEERS TAB -->
        <div id="tab-volunteers" class="tab-content">
          <div class="section-header">
            <h2 class="section-title">Gestion des bénévoles</h2>
            <div class="volunteers-actions">
              <input type="search" id="volunteers-search" class="search-input" placeholder="🔍 Rechercher (nom, prénom, email)...">
              <button id="btn-export-volunteers-csv" class="btn btn-secondary">📊 Export CSV</button>
            </div>
          </div>

          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Prénom</th>
                  <th>Nom</th>
                  <th>Email</th>
                  <th>Téléphone</th>
                  <th>Participations</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="volunteers-table-body">
                <tr>
                  <td colspan="6" class="table-empty">Aucun bénévole enregistré</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- ADMINS TAB -->
        <div id="tab-admins" class="tab-content">
          <div class="section-header">
            <h2 class="section-title">Gestion des administrateurs</h2>
            <button id="btn-add-admin" class="btn btn-primary">➕ Ajouter admin</button>
          </div>

          <div class="table-wrapper">
            <table class="data-table admins-table">
              <thead>
                <tr>
                  <th>Email</th>
                  <th>Nom</th>
                  <th>Voir Events</th>
                  <th>Éditer Events</th>
                  <th>Voir Stats</th>
                  <th>Voir Logs</th>
                  <th>Voir Bénévoles</th>
                  <th>Gérer Admins</th>
                  <th>Config</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="admins-table-body">
                <tr>
                  <td colspan="10" class="table-empty">Aucun administrateur</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- CONFIG TAB -->
        <div id="tab-config" class="tab-content">
          <h2 class="section-title">Configuration de l'application</h2>
          
          <div class="config-section">
            <h3 class="config-title">Logo de l'application</h3>
            <div class="config-logo">
              <img id="config-logo-preview" src="" alt="Logo preview" style="display:none;" class="logo-preview">
              <div class="config-logo-actions">
                <label for="config-logo-upload" class="btn btn-secondary">📤 Upload Logo (max 2MB)</label>
                <input type="file" id="config-logo-upload" accept="image/*" style="display:none;">
                <button id="config-logo-delete" class="btn btn-danger" style="display:none;">🗑️ Supprimer</button>
              </div>
            </div>
          </div>

          <div class="config-section">
            <h3 class="config-title">Texte d'introduction</h3>
            <textarea id="config-intro-text" class="config-textarea" rows="4" placeholder="Saisissez le texte d'introduction..."></textarea>
            <button id="config-intro-save" class="btn btn-primary">💾 Enregistrer</button>
          </div>

          <div class="config-section">
            <h3 class="config-title">Types d'événements</h3>
            <textarea id="config-event-types" class="config-textarea" rows="3" placeholder='["soirée", "atelier", "sortie"]'></textarea>
            <button id="config-types-save" class="btn btn-primary">💾 Enregistrer</button>
            <p class="config-help">Format JSON array, ex: ["soirée", "atelier", "sortie", "conférence"]</p>
          </div>
        </div>

        <!-- LOGS TAB -->
        <div id="tab-logs" class="tab-content">
          <h2 class="section-title">Journaux d'activité (100 derniers)</h2>
          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Date/Heure</th>
                  <th>Admin</th>
                  <th>Action</th>
                  <th>Type</th>
                  <th>ID Entité</th>
                </tr>
              </thead>
              <tbody id="logs-table-body">
                <tr>
                  <td colspan="5" class="table-empty">Aucun log disponible</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>

  </div>

  <!-- EVENT DETAIL MODAL (PUBLIC) -->
  <div id="modal-event-detail" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2 id="modal-event-title" class="modal-title"></h2>
        <button class="modal-close" aria-label="Fermer">&times;</button>
      </div>
      <div class="modal-body">
        <div id="modal-event-info"></div>
        <form id="form-inscription" class="inscription-form">
          <h3 class="form-section-title">Inscription à l'événement</h3>
          
          <div class="form-group">
            <label for="inscr-prenom">Prénom *</label>
            <input type="text" id="inscr-prenom" required>
          </div>
          
          <div class="form-group">
            <label for="inscr-nom">Nom *</label>
            <input type="text" id="inscr-nom" required>
          </div>
          
          <div class="form-group">
            <label for="inscr-email">Email *</label>
            <input type="email" id="inscr-email" required>
          </div>
          
          <div class="form-group">
            <label for="inscr-telephone">Téléphone *</label>
            <input type="tel" id="inscr-telephone" placeholder="06 12 34 56 78" required>
          </div>
          
          <div class="form-group">
            <label>Type de participation * (au moins 1)</label>
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" name="participation" value="preparation_salle">
                <span>Préparation de la salle</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="participation" value="partie_evenement">
                <span>Partie de l'événement</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="participation" value="evenement_entier">
                <span>Événement entier</span>
              </label>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-large">✅ S'inscrire</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ADMIN LOGIN MODAL -->
  <div id="modal-admin-login" class="modal">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2 class="modal-title">🔐 Connexion Administration</h2>
        <button class="modal-close" aria-label="Fermer">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-admin-login">
          <div class="form-group">
            <label for="admin-email">Email</label>
            <input type="email" id="admin-email" required>
          </div>
          <div class="form-group">
            <label for="admin-password">Mot de passe</label>
            <input type="password" id="admin-password" required>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-large">Se connecter</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- EVENT CREATE/EDIT MODAL (ADMIN) -->
  <div id="modal-event-form" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2 id="modal-event-form-title" class="modal-title">Créer un événement</h2>
        <button class="modal-close" aria-label="Fermer">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-event">
          <input type="hidden" id="event-id">
          
          <div class="form-row">
            <div class="form-group">
              <label for="event-titre">Titre *</label>
              <input type="text" id="event-titre" maxlength="120" required>
            </div>
            <div class="form-group">
              <label for="event-image">Emoji *</label>
              <input type="text" id="event-image" maxlength="8" placeholder="🎉" required>
            </div>
          </div>

          <div class="form-group">
            <label for="event-description">Description</label>
            <textarea id="event-description" rows="3"></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="event-date">Date *</label>
              <input type="date" id="event-date" required>
            </div>
            <div class="form-group">
              <label for="event-heure">Heure *</label>
              <input type="time" id="event-heure" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="event-lieu">Lieu *</label>
              <input type="text" id="event-lieu" maxlength="120" required>
            </div>
            <div class="form-group">
              <label for="event-type">Type *</label>
              <select id="event-type" required>
                <option value="">-- Sélectionner --</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="event-max-participants">Nombre max de participants *</label>
            <input type="number" id="event-max-participants" min="1" required>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="event-visible">
              <span>Événement visible (public)</span>
            </label>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary modal-close">Annuler</button>
            <button type="submit" class="btn btn-primary">💾 Enregistrer</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- VOLUNTEER HISTORY MODAL -->
  <div id="modal-volunteer-history" class="modal">
    <div class="modal-content modal-medium">
      <div class="modal-header">
        <h2 id="modal-volunteer-history-title" class="modal-title">Historique bénévole</h2>
        <button class="modal-close" aria-label="Fermer">&times;</button>
      </div>
      <div class="modal-body">
        <div id="volunteer-history-list"></div>
      </div>
    </div>
  </div>

  <!-- TOAST NOTIFICATIONS -->
  <div id="toast-container" class="toast-container"></div>

  <script src="app.js"></script>

</body>
</html>
