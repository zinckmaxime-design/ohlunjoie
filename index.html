<!--
  Ohlun'Joie V3.0
  Fichier HTML principal pour la gestion d'√©v√©nements associatifs.
  Cette page contient √† la fois l'interface publique (visiteurs) et
  l'interface d'administration (back‚Äëoffice complet). La logique
  d'interaction et de mise √† jour des donn√©es est impl√©ment√©e dans
  app.js ; ce fichier d√©finit uniquement la structure et les
  √©l√©ments n√©cessaires pour accrocher les comportements JavaScript.
  Le style est d√©fini dans style.css. Con√ßu pour √™tre enti√®rement
  responsive et accessible, avec un th√®me clair et sombre.
-->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ohlun'Joie V3.0</title>
  <!-- Ic√¥ne favicon (optionnel) -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üéâ</text></svg>">
  <!-- Feuille de style principale -->
  <link rel="stylesheet" href="style.css">
  <!-- Script Supabase CDN v2 -->
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- Script application -->
  <script defer src="app.js"></script>
</head>
<body>
  <!-- En-t√™te g√©n√©ral avec titre et boutons de navigation -->
  <header class="app-header">
    <div class="container">
      <h1 class="app-title">Ohlun'Joie</h1>
      <nav class="main-nav" aria-label="Navigation principale">
        <button id="theme-toggle" class="theme-toggle" aria-label="Basculer le th√®me">üåô</button>
        <button id="admin-toggle" class="admin-toggle" aria-label="Acc√©der √† l'administration">Espace Admin</button>
      </nav>
    </div>
  </header>

  <main>
    <!-- Section publique visible par d√©faut -->
    <section id="public-section" class="section">
      <div class="container">
        <!-- Introduction configurable via app_config.intro_text -->
        <p id="intro-text" class="intro-text"></p>

        <!-- Compteur du prochain √©v√©nement -->
        <div id="next-event-countdown" class="countdown" aria-live="polite"></div>

        <!-- Contr√¥les de vue : timeline, liste ou cartes -->
        <div class="view-switch" role="tablist" aria-label="Modes d'affichage des √©v√©nements">
          <button class="view-btn" data-view="timeline" role="tab" aria-selected="true">Timeline</button>
          <button class="view-btn" data-view="list" role="tab" aria-selected="false">Liste</button>
          <button class="view-btn" data-view="cards" role="tab" aria-selected="false">Cartes</button>
        </div>

        <!-- Conteneur pour l'affichage des √©v√©nements publics -->
        <div id="events-container" class="events-container timeline-view" aria-live="polite"></div>

        <!-- Notice RGPD -->
        <div id="rgpd-notice" class="notice-rgpd">
          <p>
            En vous inscrivant, vous acceptez que vos donn√©es soient utilis√©es pour g√©rer votre participation.
            Conform√©ment au RGPD, vous pouvez √† tout moment demander la suppression de vos informations.
          </p>
        </div>
      </div>
    </section>

    <!-- Section administrateur (cach√©e jusqu'√† authentification) -->
    <section id="admin-section" class="section hidden">
      <div class="container">
        <!-- Formulaire de connexion admin -->
        <div id="admin-login" class="admin-login">
          <h2>Connexion administrateur</h2>
          <form id="admin-login-form">
            <div class="form-group">
              <label for="admin-email">Email</label>
              <input type="email" id="admin-email" name="email" required autocomplete="username" aria-required="true">
            </div>
            <div class="form-group">
              <label for="admin-password">Mot de passe</label>
              <input type="password" id="admin-password" name="password" required autocomplete="current-password" aria-required="true">
            </div>
            <button type="submit" class="btn primary">Se connecter</button>
            <div id="admin-login-error" class="error-message" role="alert"></div>
          </form>
        </div>

        <!-- Tableau de bord et onglets (affich√©s une fois connect√©) -->
        <div id="admin-dashboard" class="admin-dashboard hidden">
          <!-- Menu onglets -->
          <nav class="admin-tabs" role="tablist" aria-label="Navigation du back‚Äëoffice">
            <button class="tab-btn active" data-tab="dashboard" role="tab" aria-selected="true">Tableau de bord</button>
            <button class="tab-btn" data-tab="events" role="tab" aria-selected="false">√âv√©nements</button>
            <button class="tab-btn" data-tab="stats" role="tab" aria-selected="false">Statistiques</button>
            <button class="tab-btn" data-tab="volunteers" role="tab" aria-selected="false">B√©n√©voles</button>
            <button class="tab-btn" data-tab="admins" role="tab" aria-selected="false">Admins</button>
            <button class="tab-btn" data-tab="config" role="tab" aria-selected="false">Configuration</button>
            <button class="tab-btn" data-tab="logs" role="tab" aria-selected="false">Logs</button>
          </nav>

          <!-- Contenu des onglets -->
          <div id="tab-dashboard" class="tab-content" role="tabpanel">
            <h2>Tableau de bord</h2>
            <div class="kpi-grid">
              <div class="kpi-card">
                <h3>Total inscrits</h3>
                <p id="kpi-total-inscrits" class="kpi-value">0</p>
              </div>
              <div class="kpi-card">
                <h3>√âv√©nements actifs</h3>
                <p id="kpi-events-actifs" class="kpi-value">0</p>
              </div>
              <div class="kpi-card">
                <h3>Emails uniques</h3>
                <p id="kpi-emails-uniques" class="kpi-value">0</p>
              </div>
              <div class="kpi-card">
                <h3>Taux moyen</h3>
                <p id="kpi-taux-moyen" class="kpi-value">0%</p>
              </div>
            </div>
          </div>

          <div id="tab-events" class="tab-content hidden" role="tabpanel">
            <h2>Gestion des √©v√©nements</h2>
            <!-- Filtres des √©v√©nements -->
            <div class="filter-bar">
              <label>Filtres:
                <select id="events-filter-select">
                  <option value="actifs">Actifs</option>
                  <option value="masques">Masqu√©s</option>
                  <option value="archives">Archiv√©s</option>
                  <option value="tous">Tous</option>
                </select>
              </label>
            </div>
            <!-- Conteneur des cartes √©v√©nements (admin) -->
            <div id="admin-events-container" class="admin-events-container"></div>
            <!-- Bouton pour cr√©er un √©v√©nement -->
            <button id="create-event-btn" class="btn primary">‚ûï Cr√©er un √©v√©nement</button>
          </div>

          <div id="tab-stats" class="tab-content hidden" role="tabpanel">
            <h2>Statistiques</h2>
            <!-- KPI statistiques -->
            <div class="kpi-grid">
              <div class="kpi-card">
                <h3>Pages vues</h3>
                <p id="kpi-pages-vues" class="kpi-value">0</p>
              </div>
              <div class="kpi-card">
                <h3>Clics √©v√©nements</h3>
                <p id="kpi-clics-events" class="kpi-value">0</p>
              </div>
            </div>
            <!-- Tableau d√©taill√© des statistiques -->
            <div class="table-responsive">
              <table id="stats-table" class="data-table">
                <thead>
                  <tr>
                    <th>Titre</th>
                    <th>Vues</th>
                    <th>Clics</th>
                    <th>Inscrits</th>
                    <th>Places</th>
                    <th>Taux</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <!-- Actions d'export -->
            <div class="export-actions">
              <button id="export-emails-btn" class="btn secondary">üìß Export Emails (TXT)</button>
              <button id="export-stats-btn" class="btn secondary">üìÑ Export Stats (CSV)</button>
            </div>
          </div>

          <div id="tab-volunteers" class="tab-content hidden" role="tabpanel">
            <h2>B√©n√©voles</h2>
            <div class="search-bar">
              <label for="volunteer-search">Recherche¬†:</label>
              <input type="text" id="volunteer-search" placeholder="Nom, pr√©nom ou email">
            </div>
            <div class="table-responsive">
              <table id="volunteers-table" class="data-table">
                <thead>
                  <tr>
                    <th>Pr√©nom</th>
                    <th>Nom</th>
                    <th>Email</th>
                    <th>T√©l√©phone</th>
                    <th>Participation</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <div class="export-actions">
              <button id="export-volunteers-btn" class="btn secondary">üìÑ Export CSV</button>
            </div>
          </div>

          <div id="tab-admins" class="tab-content hidden" role="tabpanel">
            <h2>Gestion des administrateurs</h2>
            <button id="add-admin-btn" class="btn primary">‚ûï Ajouter admin</button>
            <div class="table-responsive">
              <table id="admins-table" class="data-table">
                <thead>
                  <tr>
                    <th>Email</th>
                    <th>Nom</th>
                    <th>Voir √âv√©nements</th>
                    <th>Modifier √âv√©nements</th>
                    <th>Voir Stats</th>
                    <th>Voir Logs</th>
                    <th>Voir B√©n√©voles</th>
                    <th>G√©rer Admins</th>
                    <th>Config</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <div id="tab-config" class="tab-content hidden" role="tabpanel">
            <h2>Configuration</h2>
            <form id="config-form" class="config-form">
              <!-- Logo upload -->
              <div class="form-group">
                <label for="logo-input">Logo (PNG/JPEG/SVG ‚â§ 2¬†Mo)</label>
                <input type="file" id="logo-input" accept="image/*">
                <div id="logo-preview" class="logo-preview"></div>
                <button type="button" id="remove-logo-btn" class="btn danger small">Supprimer le logo</button>
              </div>
              <!-- Texte d'introduction -->
              <div class="form-group">
                <label for="intro-textarea">Texte d'introduction</label>
                <textarea id="intro-textarea" rows="4"></textarea>
              </div>
              <!-- Types d'√©v√©nements -->
              <div class="form-group">
                <label for="event-types-textarea">Types d'√©v√©nements (JSON array)</label>
                <textarea id="event-types-textarea" rows="4"></textarea>
              </div>
              <button type="submit" class="btn primary">Enregistrer la configuration</button>
            </form>
          </div>

          <div id="tab-logs" class="tab-content hidden" role="tabpanel">
            <h2>Logs d'activit√©</h2>
            <div class="table-responsive">
              <table id="logs-table" class="data-table">
                <thead>
                  <tr>
                    <th>Admin</th>
                    <th>Action</th>
                    <th>Entit√©</th>
                    <th>ID</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div> <!-- fin admin-dashboard -->
      </div> <!-- fin container -->
    </section>
  </main>

  <!-- Modale cr√©ation/√©dition √©v√©nement -->
  <div id="event-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal-content">
      <h2 id="modal-title">Nouvel √©v√©nement</h2>
      <form id="event-form">
        <div class="form-group">
          <label for="event-emoji">Emoji</label>
          <input type="text" id="event-emoji" maxlength="2" placeholder="üéâ" required aria-required="true">
        </div>
        <div class="form-group">
          <label for="event-title">Titre</label>
          <input type="text" id="event-title" required aria-required="true">
        </div>
        <div class="form-group">
          <label for="event-description">Description</label>
          <textarea id="event-description" rows="3"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="event-date">Date</label>
            <input type="date" id="event-date" required aria-required="true">
          </div>
          <div class="form-group">
            <label for="event-time">Heure</label>
            <input type="time" id="event-time" required aria-required="true">
          </div>
        </div>
        <div class="form-group">
          <label for="event-location">Lieu</label>
          <input type="text" id="event-location" required aria-required="true">
        </div>
        <div class="form-group">
          <label for="event-type">Type d'√©v√©nement</label>
          <select id="event-type" required aria-required="true"></select>
        </div>
        <div class="form-group">
          <label for="event-max-participants">Places disponibles</label>
          <input type="number" id="event-max-participants" min="1" required aria-required="true">
        </div>
        <div class="form-group">
          <label for="event-visible">
            <input type="checkbox" id="event-visible" checked>
            Visible au public
          </label>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn primary">Enregistrer</button>
          <button type="button" id="event-modal-cancel" class="btn secondary">Annuler</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modale ajout d'un administrateur -->
  <div id="add-admin-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="add-admin-title">
    <div class="modal-content">
      <h2 id="add-admin-title">Ajouter un administrateur</h2>
      <form id="add-admin-form">
        <div class="form-group">
          <label for="new-admin-email">Email</label>
          <input type="email" id="new-admin-email" required aria-required="true">
        </div>
        <div class="form-group">
          <label for="new-admin-first-name">Pr√©nom</label>
          <input type="text" id="new-admin-first-name" required aria-required="true">
        </div>
        <div class="form-group">
          <label for="new-admin-last-name">Nom</label>
          <input type="text" id="new-admin-last-name" required aria-required="true">
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn primary">Ajouter</button>
          <button type="button" id="add-admin-cancel" class="btn secondary">Annuler</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modale pour afficher l'historique d'un b√©n√©vole -->
  <div id="volunteer-history-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="volunteer-history-title">
    <div class="modal-content">
      <h2 id="volunteer-history-title">Historique des participations</h2>
      <div class="table-responsive">
        <table id="volunteer-history-table" class="data-table">
          <thead>
            <tr>
              <th>√âv√©nement</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="modal-actions">
        <button type="button" id="volunteer-history-close" class="btn secondary">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Conteneur pour les notifications (toasts) -->
  <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

</body>
</html>
